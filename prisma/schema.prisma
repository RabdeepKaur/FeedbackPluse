// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified DateTime?
  password      String?
  name          String?
  provider      String?
  providerId    String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLoginAt   DateTime?
  
  projects      Project[]
  sessions      Session[]
  
  @@index([email])
  @@map("users")
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  token        String   @unique
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([token])
  @@map("sessions")
}

model Project {
  id             String    @id @default(cuid())
  name           String
  projectKey     String    @unique @default(cuid())
  isActive       Boolean   @default(true)
  allowedDomains String[]  @default([])
  userId         String
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  
  feedback       Feedback[]
  
  @@index([userId])
  @@index([projectKey])
  @@map("projects")
}

enum FeedbackType {
  BUG
  FEATURE
  OTHER
}

enum SentimentType {
  POSITIVE
  NEUTRAL
  NEGATIVE
}

model Feedback {
  id             String        @id @default(cuid())
  title          String?
  message        String
  type           FeedbackType  @default(OTHER)
  userEmail      String?
  userName       String?
  pageUrl        String?
  isResolved     Boolean       @default(false)
  priority       Int           @default(0)
  sentiment      SentimentType @default(NEUTRAL)
  sentimentScore Float?
  projectId      String
  project        Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  
  labels         FeedbackLabel[]
  
  @@index([projectId])
  @@index([type])
  @@index([sentiment])
  @@index([createdAt])
  @@map("feedback")
}

model Label {
  id          String    @id @default(cuid())
  name        String
  color       String    @default("#3B82F6")
  description String?
  userId      String
  projectId   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  feedback    FeedbackLabel[]
  
  @@unique([name, userId, projectId])
  @@index([userId])
  @@index([projectId])
  @@map("labels")
}

model FeedbackLabel {
  id         String   @id @default(cuid())
  feedbackId String
  feedback   Feedback @relation(fields: [feedbackId], references: [id], onDelete: Cascade)
  labelId    String
  label      Label    @relation(fields: [labelId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
  
  @@unique([feedbackId, labelId])
  @@index([feedbackId])
  @@index([labelId])
  @@map("feedback_labels")
}